â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                                                                          â•‘
â•‘            ğŸ‰ SIMA SCRAPER - ARQUITECTURA MODULAR COMPLETADA ğŸ‰         â•‘
â•‘                                                                          â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“¦ ARCHIVOS CREADOS
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ“„ Postman:
   â”œâ”€â”€ SIMA_Scraper_Postman_Collection.json  ğŸ“® 24 endpoints listos
   â””â”€â”€ Variables pre-configuradas âœ…


ğŸ—ï¸ Arquitectura Modular (scraping-service/):
   â”œâ”€â”€ ARCHITECTURE.md                  ğŸ“ Arquitectura detallada
   â”œâ”€â”€ src/services/
   â”‚   â”œâ”€â”€ scraperService.ts           ğŸ¯ Orquestador principal
   â”‚   â”œâ”€â”€ modules/                    ğŸ“¦ Servicios modulares
   â”‚   â”‚   â”œâ”€â”€ sessionService.ts       ğŸ”‘ GestiÃ³n de sesiones
   â”‚   â”‚   â”œâ”€â”€ coursesService.ts       ğŸ“š ObtenciÃ³n de cursos
   â”‚   â”‚   â”œâ”€â”€ calendarService.ts      ğŸ“… Eventos del calendario
   â”‚   â”‚   â”œâ”€â”€ activitiesService.ts    âœ¨ Fechas apertura/cierre
   â”‚   â”‚   â””â”€â”€ index.ts
   â”‚   â”œâ”€â”€ helpers/                    ğŸ› ï¸ Utilidades
   â”‚   â”‚   â”œâ”€â”€ cookieParser.ts         ğŸª Parser de cookies
   â”‚   â”‚   â”œâ”€â”€ timeParser.ts           â° ConversiÃ³n de tiempos
   â”‚   â”‚   â”œâ”€â”€ eventTypeDetector.ts    ğŸ” DetecciÃ³n de tipos
   â”‚   â”‚   â””â”€â”€ index.ts
   â”‚   â””â”€â”€ README.md                   ğŸ“– Docs de servicios

âš™ï¸ ConfiguraciÃ³n:
   â””â”€â”€ .env                            âœ… Creado con valores por defecto


ğŸš€ INICIO RÃPIDO
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

1ï¸âƒ£  Levantar Docker:
   docker-compose up -d --build

2ï¸âƒ£  Verificar:
   http://localhost:8080/api/health  âœ…

3ï¸âƒ£  Importar en Postman:
   SIMA_Scraper_Postman_Collection.json

4ï¸âƒ£  Endpoints principales:
   POST /api/auth/register           â†’ Registrar usuario
   POST /api/auth/login              â†’ Login (JWT auto-guardado)
   POST /api/courses/sync            â†’ Sincronizar cursos
   GET  /api/schedule/week           â†’ Horario CON fechas â­


ğŸ¯ FUNCIONALIDAD PRINCIPAL
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

âœ¨ EXTRACCIÃ“N DE FECHAS DE APERTURA Y CIERRE âœ¨

El sistema ahora extrae automÃ¡ticamente:
  â€¢ Fecha de apertura de actividades
  â€¢ Fecha de cierre de actividades
  â€¢ Para asignaciones, evaluaciones, tareas, etc.

Ejemplo de respuesta:
{
  "activities": [
    {
      "title": "Protocolo individual de la unidad 2",
      "activityDates": {
        "apertura": "lunes, 18 de agosto de 2025, 15:23",
        "cierre": "sÃ¡bado, 11 de octubre de 2025, 15:23"
      }
    }
  ]
}


ğŸ—ï¸ ARQUITECTURA
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

                  Cliente (Postman / Frontend)
                            â†“
                   API Gateway :8080  â­
                 (Punto de entrada Ãºnico)
                            â†“
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â†“                                 â†“
    Main API :3000                   Scraping Service :3001
           â†“                                 â†“
    MongoDB :27017              MÃ³dulos Especializados
                                  â€¢ SessionService
                                  â€¢ CoursesService
                                  â€¢ CalendarService
                                  â€¢ ActivitiesService
                                  â€¢ Helpers


âœ… VENTAJAS DE LA ARQUITECTURA MODULAR
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

âœ“ SeparaciÃ³n de responsabilidades
âœ“ CÃ³digo limpio y mantenible
âœ“ FÃ¡cil de testear (mÃ³dulos independientes)
âœ“ Escalable (agregar nuevos servicios sin afectar existentes)
âœ“ Helpers reutilizables
âœ“ DocumentaciÃ³n completa
âœ“ Retrocompatible (mismo API pÃºblico)


ğŸ“Š ENDPOINTS DISPONIBLES (24 total)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ” Authentication (2)
   POST   /api/auth/register
   POST   /api/auth/login

ğŸ“š Courses (2)
   GET    /api/courses
   POST   /api/courses/sync

ğŸ“… Schedule (7)
   GET    /api/schedule/day
   GET    /api/schedule/week
   GET    /api/schedule/month
   GET    /api/schedule/upcoming
   GET    /api/schedule/upcoming/:courseId
   GET    /api/schedule/history/:days
   DELETE /api/schedule/cache

ğŸ” Scraping Direct (6)
   POST   /api/scraping/courses
   POST   /api/scraping/schedule/day
   POST   /api/scraping/schedule/week
   POST   /api/scraping/schedule/month
   POST   /api/scraping/schedule/upcoming
   POST   /api/scraping/upcoming/:courseId

ğŸ¥ Health Checks (3)
   GET    /api/health
   GET    /health (Main API)
   GET    /api/scraping/health


ğŸ› ï¸ COMANDOS ÃšTILES
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Docker:
  docker-compose up -d --build       â†’ Iniciar todo
  docker-compose ps                  â†’ Ver estado
  docker-compose logs -f             â†’ Ver logs
  docker-compose restart             â†’ Reiniciar
  docker-compose down                â†’ Detener todo

Testing:
  test-endpoints.bat                 â†’ Tests automÃ¡ticos (Windows)
  ./test-endpoints.sh                â†’ Tests automÃ¡ticos (Linux/Mac)

Build (sin Docker):
  cd scraping-service
  npm install
  npm run build
  npm run dev


ğŸ“– DOCUMENTACIÃ“N
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Lee estos archivos en orden:

1. EMPEZAR_AQUI.md                    â†’ Inicio rÃ¡pido (5 minutos)
2. SETUP_COMPLETO.md                  â†’ GuÃ­a paso a paso completa
3. POSTMAN_SETUP.md                   â†’ CÃ³mo usar Postman
4. DOCKER_QUICKSTART.md               â†’ Todo sobre Docker
5. scraping-service/ARCHITECTURE.md   â†’ Arquitectura modular
6. scraping-service/src/services/README.md  â†’ MÃ³dulos detallados


ğŸ“ Â¿CÃ“MO FUNCIONA LA EXTRACCIÃ“N DE FECHAS?
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

1. Usuario hace: GET /api/schedule/week

2. CalendarService obtiene eventos del calendario

3. ActivitiesService detecta actividades tipo "assignment"

4. Para cada assignment:
   â†’ Construye URL: .../view.php?id=X&action=editsubmission
   â†’ Hace peticiÃ³n HTTP con cookies del usuario
   â†’ Parsea HTML buscando [data-region="activity-dates"]
   â†’ Extrae texto de "Apertura:" y "Cierre:"

5. Retorna eventos enriquecidos con activityDates

Flujo visual:
  Cliente â†’ API Gateway â†’ Main API â†’ Scraping Service
                                           â†“
                      SessionService â†’ Obtiene sesskey
                      CalendarService â†’ Obtiene eventos
                      ActivitiesService â†’ Extrae fechas
                                           â†“
                                        SIMA


ğŸ”§ SOLUCIÃ“N DE PROBLEMAS COMUNES
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

âŒ "Connection refused"
   â†’ docker-compose ps
   â†’ docker-compose logs api-gateway
   â†’ docker-compose restart

âŒ "Invalid credentials"
   â†’ Verifica credenciales de SIMA al registrar

âŒ "No working URL found"
   â†’ Cookies expiradas, re-autenticarse

âŒ No veo fechas de apertura/cierre
   â†’ Verificar que la actividad tenga fechas en SIMA
   â†’ Solo funciona para tipo "assignment"

âŒ Puerto ocupado
   â†’ Cambiar puerto en docker-compose.yml
   â†’ O detener proceso: taskkill /PID X /F


âœ… VERIFICACIÃ“N FINAL
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Antes de usar, verificar:

â˜‘ Docker Desktop corriendo
â˜‘ Puertos 8080, 3000, 3001, 27017 libres
â˜‘ .env existe con JWT_SECRET y ENCRYPTION_KEY
â˜‘ docker-compose ps muestra todos "Up"
â˜‘ http://localhost:8080/api/health responde "ok"
â˜‘ Postman collection importada
â˜‘ Variables de Postman configuradas:
  â€¢ BASE_URL = http://localhost:8080
  â€¢ SCRAPING_URL = http://localhost:3001


ğŸš€ Â¡TODO LISTO!
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

1. docker-compose up -d --build
2. Importar colecciÃ³n en Postman



